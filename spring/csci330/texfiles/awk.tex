\documentclass{report}

\input{~/latex/template/preamble.tex}
\input{~/latex/template/macros.tex}

\title{\Huge{Introduction to awk}}
\author{\huge{Matt Warner}}
\date{\huge{}}
\pagestyle{fancy}
\fancyhf{}
\rhead{}
\lhead{\leftmark}
\cfoot{\thepage}
% \usepackage[default]{sourcecodepro} \usepackage[T1]{fontenc}

\pgfpagesdeclarelayout{boxed}
{
  \edef\pgfpageoptionborder{0pt}
}
{
  \pgfpagesphysicalpageoptions
  {%
    logical pages=1,%
  }
  \pgfpageslogicalpageoptions{1}
  {
    border code=\pgfsetlinewidth{1.5pt}\pgfstroke,%
    border shrink=\pgfpageoptionborder,%
    resized width=.95\pgfphysicalwidth,%
    resized height=.95\pgfphysicalheight,%
    center=\pgfpoint{.5\pgfphysicalwidth}{.5\pgfphysicalheight}%
  }%
}

\pgfpagesuselayout{boxed}

\begin{document}
  \maketitle
  \section{What is awk?}  
  \begin{itemize}
    \item Created by: 
      \subitem Aho, Weinberger and Kernighan.
    \item awk is a scripting language used for manipulating data and generating reports
    \item Versions of awk:
      \subitem awk, nawk, mawk, pgawk, \ldots
    \item GNU awk: gawk
  \end{itemize}
\section{What can you do with awk?}
\begin{itemize}
  \item awk operation: 
    \begin{itemize}[label=$\circ$]
      \item reads a file line by line 
      \item splits each input line into fields
      \item compares input line/fields to pattern
        performs action(s) on matched lines
    \end{itemize}
  \item Useful for:
    \begin{itemize}[label=$\circ$]
      \item transforming data files 
      \item producing formatted reports
    \end{itemize}
  \item Programming constructs
    \begin{itemize}[label=$\circ$]
      \item format output lines 
      \item arithmetic and string operations
      \item conditionals and loops
    \end{itemize}
\end{itemize}
\section{Basic awk invocation}
\bigbreak \noindent
\textbf{\textit{Syntax:}}
\begin{minted}{bash}
awk 'script' file(s)

awk -f scriptfile file(s) 
\end{minted}
\bigbreak \noindent
   Common option: -F (to change the field seperator)
   \section{Basic awk script}
   \begin{itemize}
     \item consists of patterns \& actions: 
   \end{itemize}
   \bigbreak \noindent
   \textbf{\textit{Syntax:}}
   \begin{minted}{bash}
   pattern {action}
   \end{minted}
   \bigbreak \noindent
   \begin{itemize}
     \item If pattern is missing, action is applied to all lines 
     \item if action is missing, the matched line is printed
     \item Must have either pattern or action
   \end{itemize}
   \bigbreak \noindent
   \textbf{\underline{Example:}}
   \begin{minted}{bash}
    # print all lines containing string "for" in testfile

    awk '/for/ { print }' testfile
   \end{minted}
   \newpage \noindent
   \section{awk variables}
   awk reads input line into buffers \textit{\textbf{record}} and \textit{\textbf{fields}}
   \begin{itemize}
     \item field buffer: 
       \begin{itemize}[label=$\bullet$]
        \item One for each field in the current record 
        \item Variable names: \$1, \$2, \ldots
       \end{itemize}
     \item record buffer:
       \begin{itemize}[label=$\bullet$]
         \item \$0 holds the entire record
       \end{itemize}
   \end{itemize}
   \subsection{More variables}
  NR \ \ \ Number of the current record \vspace{1.5mm}

  \noindent  NF \ \ \ Number of fields in the current record \vspace{1.5mm}
  
 \noindent \textit{\textbf{Also:}} \vspace{2mm}

  \noindent FS \ \ \ Field sperator (default=whitespace)
\bigbreak \noindent
\textbf{\underline{Example:}}
\bigbreak \noindent
Say we had a file called emps:
\begin{minted}{bash}
~$ cat emps
Tom Jones     4424     5/12/66    543354
Mary Adams    5346     11/4/63    28765
Sally Chang   1654     7/22/54    6500000
Billy Black   1683     9/23/44    336500

$ awk '/Tom/ { print $0 }' emps
Tom Jones     4424     5/12/66    543354

$ awk '{ print NR, $0 }' emps
1 Tom Jones     4424     5/12/66    543354
2 Mary Adams    5346     11/4/63    28765
3 Sally Chang   1654     7/22/54    6500000
4 Billy Black   1683     9/23/44    336500
\end{minted}
\subsection*{Example: Space as Field Separator}
\begin{mdframed}
  \begin{minted}{bash}
~$ cat emps
Tom Jones     4424     5/12/66    543354
Mary Adams    5346     11/4/63    28765
Sally Chang   1654     7/22/54    6500000
Billy Black   1683     9/23/44    336500

awk '{ print NR, $1, $2, $5 }' emps

1 Tom Jones     543354
2 Mary Adams    28765
3 Sally Chang   6500000
4 Billy Black   336500
\end{minted}
\end{mdframed}
\newpage
\subsection*{Example: Colon as Field Seperator}
\begin{minted}{bash}
~$ cat emps2
Tom Jones:4424:5/12/66:543354
Mary Adams:5346:11/4/63:28765
Sally Chang:1654:7/22/54:650000
Billy Black:1683:9/23/44:336500

awk -F: '/Jones/{ print $1, $2 }' emps2
Tom Jones 4424

awk -F: '/Jones/{print $1, $3}' emps2
Tom Jones 5/12/66
\end{minted}
\subsection*{Example: File Processing}
$ cat input
\end{document}
